<% f.fields_for role in User::ROLES %>
  <%= check_box_tag "user[roles][#{role}]", role, @user.roles.include?(role), {:name => "user[roles][]"}%>
  <%= f.collection_check_boxes :role, User::ROLES,  %>
  <%= label_tag "user_roles_#{role}", role.to_s.humanize %><br />
<% end %>
  <%= hidden_field_tag "user[roles][]", "" %>
